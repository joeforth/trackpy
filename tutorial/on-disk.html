<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Streaming: Processing Unlimited Frames On-Disk &mdash; trackpy 0.2.3-236-gad699e2 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.2.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.3-236-gad699e2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="trackpy 0.2.3-236-gad699e2 documentation" href="../index.html" />
    <link rel="next" title="Making trackpy fast(er)" href="performance.html" />
    <link rel="prev" title="Adaptive Search: Changing search_range on the Fly" href="adaptive-search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          trackpy</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2.3-236-gad699e2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../tutorial.html">Tutorial</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to Trackpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing Trackpy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html#updating-your-installation">Updating Your Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What&#8217;s new in the package</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="prediction.html">Prediction: Beyond Simple Random Walks</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracking-3d.html">Feature finding in 3D confocal images</a></li>
<li class="toctree-l1"><a class="reference internal" href="uncertainty.html">Subpixel Accuracy and Uncertainty Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="subnets.html">Advanced Linking: Subnetworks and <code class="docutils literal"><span class="pre">search_range</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="adaptive-search.html">Adaptive Search: Changing <code class="docutils literal"><span class="pre">search_range</span></code> on the Fly</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Streaming: Processing Unlimited Frames On-Disk</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Making trackpy fast(er)</a></li>
<li class="toctree-l1"><a class="reference internal" href="linking-diagnostics.html">Obtaining Diagnostic Information from Linking</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallel-locate.html">Parallelized Feature Location using IPython Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-feature-detection.html">Custom Feature Detection: Bubble tracking in 2D foams</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Streaming: Processing Unlimited Frames On-Disk</a><ul>
<li><a class="reference internal" href="#install-pytables">Install PyTables</a></li>
<li><a class="reference internal" href="#locate-features-streaming-results-into-an-hdf5-file">Locate Features, Streaming Results into an HDF5 File</a></li>
<li><a class="reference internal" href="#link-trajectories-streaming-from-and-updating-the-hdf5-file">Link Trajectories, Streaming From and Updating the HDF5 File</a></li>
<li><a class="reference internal" href="#framewise-data-interfaces">Framewise Data Interfaces</a><ul>
<li><a class="reference internal" href="#built-in-interfaces">Built-in interfaces</a></li>
<li><a class="reference internal" href="#writing-your-own-interface">Writing your own interface</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="streaming-processing-unlimited-frames-on-disk">
<h1>Streaming: Processing Unlimited Frames On-Disk<a class="headerlink" href="#streaming-processing-unlimited-frames-on-disk" title="Permalink to this headline">¶</a></h1>
<p>A key feature of trackpy is the ability to process an unlimited number
of frames.</p>
<p>For feature-finding, this is straightforward: a frame is loaded,
features are located, the locations are saved the disk, and the memory
is cleared for the next frame. For linking, the problem is more
challenging, but trackpy handles all this complexity for you, using as
little memory as possible throughout.</p>
<p>When data sets become large, beginning-friendly file formats like CSV or
Excel become impractical. We recommend using the HDF5 file format, which
is trackpy can read and write out of the box. (HDF5 is <a class="reference external" href="http://en.wikipedia.org/wiki/Hierarchical_Data_Format">widely
used</a>; you can
be sure it will be around for many, many years to come.)</p>
<p>If you have some other format in mind, see the end of this tutorial,
where we explain how to extend trackpy&#8217;s interface to support other
formats.</p>
<div class="section" id="install-pytables">
<h2>Install PyTables<a class="headerlink" href="#install-pytables" title="Permalink to this headline">¶</a></h2>
<p>You need pytables, which you can easily install using conda. (Type this
command into a Terminal or Command Prompt.)</p>
<div class="highlight-python"><div class="highlight"><pre>conda install pytables
</pre></div>
</div>
</div>
<div class="section" id="locate-features-streaming-results-into-an-hdf5-file">
<h2>Locate Features, Streaming Results into an HDF5 File<a class="headerlink" href="#locate-features-streaming-results-into-an-hdf5-file" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">trackpy</span> <span class="kn">as</span> <span class="nn">tp</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">gray</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">images</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">ImageSequence</span><span class="p">(</span><span class="s">&#39;../sample_data/bulk_water/*.png&#39;</span><span class="p">,</span> <span class="n">process_func</span><span class="o">=</span><span class="n">gray</span><span class="p">)</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">images</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>  <span class="c"># We&#39;ll take just the first 10 frames for demo purposes.</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre># For this demo, we&#39;ll first remove the file if it already exists.
!rm -f data.h5
</pre></div>
</div>
<p>We can use <code class="docutils literal"><span class="pre">locate</span></code> inside a loop:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">tp</span><span class="o">.</span><span class="n">PandasHDFStore</span><span class="p">(</span><span class="s">&#39;data.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>  <span class="c"># This opens an HDF5 file. Data will be stored and retrieved by frame number.</span>
    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">tp</span><span class="o">.</span><span class="n">locate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c"># Find the features in a given frame.</span>
        <span class="n">s</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>  <span class="c"># Save the features to the file before continuing to the next frame.</span>
</pre></div>
</div>
<pre class="literal-block">
Note: FFTW is configuring itself. This will take several seconds, but subsequent calls will run <em>much</em> faster.
</pre>
<p>or, equivalently, we can use <code class="docutils literal"><span class="pre">batch</span></code>, which accepts the storage file
as <code class="docutils literal"><span class="pre">output</span></code>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">tp</span><span class="o">.</span><span class="n">PandasHDFStore</span><span class="p">(</span><span class="s">&#39;data.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">tp</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>We can get the data for a given frame:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">tp</span><span class="o">.</span><span class="n">PandasHDFStore</span><span class="p">(</span><span class="s">&#39;data.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">frame_2_results</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">frame_2_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c"># Display the first few rows.</span>
</pre></div>
</div>
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>mass</th>
      <th>size</th>
      <th>ecc</th>
      <th>signal</th>
      <th>ep</th>
      <th>frame</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 296.226203</td>
      <td> 5.611765</td>
      <td> 3740</td>
      <td> 2.674198</td>
      <td> 0.206035</td>
      <td>  28.527147</td>
      <td> 0.129315</td>
      <td> 2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>  68.202966</td>
      <td> 6.464481</td>
      <td> 3843</td>
      <td> 2.893729</td>
      <td> 0.087947</td>
      <td>-102.472853</td>
      <td>-0.031075</td>
      <td> 2</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 274.787286</td>
      <td> 7.891198</td>
      <td> 2454</td>
      <td> 2.970172</td>
      <td> 0.251374</td>
      <td>-102.472853</td>
      <td>-0.029638</td>
      <td> 2</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 336.889137</td>
      <td> 6.445048</td>
      <td> 3130</td>
      <td> 2.565811</td>
      <td> 0.028418</td>
      <td>  35.527147</td>
      <td> 0.112379</td>
      <td> 2</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 431.797288</td>
      <td> 6.918457</td>
      <td> 5678</td>
      <td> 3.044058</td>
      <td> 0.385238</td>
      <td>  29.527147</td>
      <td> 0.098436</td>
      <td> 2</td>
    </tr>
  </tbody>
</table>
</div><p>Or dump all the data, if your machine has enough memory to hold it:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">tp</span><span class="o">.</span><span class="n">PandasHDFStore</span><span class="p">(</span><span class="s">&#39;data.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">all_results</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>

<span class="n">all_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c"># Display the first few rows.</span>
</pre></div>
</div>
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>mass</th>
      <th>size</th>
      <th>ecc</th>
      <th>signal</th>
      <th>ep</th>
      <th>frame</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 103.419519</td>
      <td> 5.113182</td>
      <td> 2951</td>
      <td> 2.795831</td>
      <td> 0.040059</td>
      <td>-82.673458</td>
      <td>-0.040060</td>
      <td> 0</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 295.118161</td>
      <td> 5.631698</td>
      <td> 3546</td>
      <td> 2.665027</td>
      <td> 0.161466</td>
      <td> 44.326542</td>
      <td> 0.081763</td>
      <td> 0</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 310.446229</td>
      <td> 7.141150</td>
      <td> 2678</td>
      <td> 3.370511</td>
      <td> 0.019122</td>
      <td>-81.673458</td>
      <td>-0.029181</td>
      <td> 0</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 431.496378</td>
      <td> 7.273025</td>
      <td> 5798</td>
      <td> 2.872567</td>
      <td> 0.273653</td>
      <td> 26.326542</td>
      <td> 0.119659</td>
      <td> 0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>  36.061983</td>
      <td> 8.255091</td>
      <td> 4469</td>
      <td> 2.973328</td>
      <td> 0.123753</td>
      <td>-87.673458</td>
      <td>-0.033747</td>
      <td> 0</td>
    </tr>
  </tbody>
</table>
</div><p>You can dump the first N frames using <code class="docutils literal"><span class="pre">s.dump(N)</span></code>.</p>
</div>
<div class="section" id="link-trajectories-streaming-from-and-updating-the-hdf5-file">
<h2>Link Trajectories, Streaming From and Updating the HDF5 File<a class="headerlink" href="#link-trajectories-streaming-from-and-updating-the-hdf5-file" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">tp</span><span class="o">.</span><span class="n">PandasHDFStore</span><span class="p">(</span><span class="s">&#39;data.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">linked</span> <span class="ow">in</span> <span class="n">tp</span><span class="o">.</span><span class="n">link_df_iter</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">neighbor_strategy</span><span class="o">=</span><span class="s">&#39;KDTree&#39;</span><span class="p">):</span>
        <span class="n">s</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">linked</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Frame 9: 516 trajectories present
</pre></div>
</div>
<p>The original data is overwritten.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">tp</span><span class="o">.</span><span class="n">PandasHDFStore</span><span class="p">(</span><span class="s">&#39;data.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">frame_2_results</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">frame_2_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c"># Display the first few rows.</span>
</pre></div>
</div>
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>mass</th>
      <th>size</th>
      <th>ecc</th>
      <th>signal</th>
      <th>ep</th>
      <th>frame</th>
      <th>particle</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 453.934194</td>
      <td>  86.551661</td>
      <td> 1626</td>
      <td> 2.604283</td>
      <td> 0.052431</td>
      <td>-102.472853</td>
      <td>-0.037864</td>
      <td> 2</td>
      <td> 0</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 520.608638</td>
      <td> 273.942501</td>
      <td> 3774</td>
      <td> 2.462114</td>
      <td> 0.096123</td>
      <td>  40.527147</td>
      <td> 0.106703</td>
      <td> 2</td>
      <td> 2</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 191.513007</td>
      <td>  47.924380</td>
      <td> 3306</td>
      <td> 2.617476</td>
      <td> 0.070219</td>
      <td>  33.527147</td>
      <td> 0.114615</td>
      <td> 2</td>
      <td> 5</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 603.713694</td>
      <td>  92.242960</td>
      <td> 3622</td>
      <td> 2.986025</td>
      <td> 0.039404</td>
      <td> -71.472853</td>
      <td>-0.042088</td>
      <td> 2</td>
      <td> 6</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 196.552256</td>
      <td> 111.942481</td>
      <td> 2660</td>
      <td> 2.857256</td>
      <td> 0.103899</td>
      <td>-102.472853</td>
      <td>-0.031807</td>
      <td> 2</td>
      <td> 7</td>
    </tr>
  </tbody>
</table>
</div></div>
<div class="section" id="framewise-data-interfaces">
<h2>Framewise Data Interfaces<a class="headerlink" href="#framewise-data-interfaces" title="Permalink to this headline">¶</a></h2>
<div class="section" id="built-in-interfaces">
<h3>Built-in interfaces<a class="headerlink" href="#built-in-interfaces" title="Permalink to this headline">¶</a></h3>
<p>There are three different interfaces. You can use them interchangeably.
They offer different performance advantages.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">PandasHDFStore</span></code> &#8211; fastest for a small (~100) number of frames</li>
<li><code class="docutils literal"><span class="pre">PandasHDFStoreBig</span></code> &#8211; fastest for a medium or large number of
frames</li>
<li><code class="docutils literal"><span class="pre">PandasHDFStoreSingleNode</span></code> &#8211; optimizes HDF queries that access
multiple frames (advanced)</li>
</ul>
</div>
<div class="section" id="writing-your-own-interface">
<h3>Writing your own interface<a class="headerlink" href="#writing-your-own-interface" title="Permalink to this headline">¶</a></h3>
<p>Trackpy implements a generic interface that could be used to store and
retrieve particle tracking data in any file format. We hope that it can
make it easier for researchers who use different file formats to
exchange data. Any in-house format could be accessed using the same
simple interface demonstrated above.</p>
<p>At present, the interface is implemented only for HDF5 files. To extend
it to any format, write a class subclassing <code class="docutils literal"><span class="pre">trackpy.FramewiseData</span></code>.
This custom class must implement the methods <code class="docutils literal"><span class="pre">put</span></code>, <code class="docutils literal"><span class="pre">get</span></code>,
<code class="docutils literal"><span class="pre">close</span></code>, and <code class="docutils literal"><span class="pre">__iter__</span></code> and the properties <code class="docutils literal"><span class="pre">max_frame</span></code> and
<code class="docutils literal"><span class="pre">t_column</span></code>. Refer to the built-in classes in
<a class="reference external" href="https://github.com/soft-matter/trackpy/blob/master/trackpy/framewise_data.py">framewise_data.py</a>
for examples to work from.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/tutorial/on-disk.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2010-2014, Trackpy Contributors.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>